/*
 A JavaScript implementation of the SHA family of hashes, as
 defined in FIPS PUB 180-4 and FIPS PUB 202, as well as the corresponding
 HMAC implementation as defined in FIPS PUB 198a

 Copyright Brian Turek 2008-2017
 Distributed under the BSD License
 See http://caligatio.github.com/jsSHA/ for more information

 Several functions taken from Paul Johnston
*/
(function(N){function w(b,a,c){var d=0,e=[],m=0,l=!1,k=[],f=[],G=!1;c=c||{};var g=c.encoding||"UTF8";var h=c.numRounds||1;if(h!==parseInt(h,10)||1>h)throw Error("numRounds must a integer >= 1");if(b.lastIndexOf("SHA-",0))throw Error("Chosen SHA variant is not supported");var p=function(d,a){return B(d,a,b)};var q=function(d,a,c,e){if("SHA-224"===b||"SHA-256"===b){var m=(a+65>>>9<<4)+15;var l=16}else throw Error("Unexpected error in SHA-2 implementation");for(;d.length<=m;)d.push(0);d[a>>>5]|=128<<
24-a%32;a+=c;d[m]=a&4294967295;d[m-1]=a/4294967296|0;c=d.length;for(a=0;a<c;a+=l)e=B(d.slice(a,a+l),e,b);if("SHA-224"===b)d=[e[0],e[1],e[2],e[3],e[4],e[5],e[6]];else if("SHA-256"===b)d=e;else throw Error("Unexpected error in SHA-2 implementation");return d};var n=function(d){return d.slice()};if("SHA-224"===b){var u=512;var r=224}else if("SHA-256"===b)u=512,r=256;else throw Error("Chosen SHA variant is not supported");var w=H(a,g);var t=y(b);this.setHMACKey=function(a,c,e){if(!0===l)throw Error("HMAC key already set");
if(!0===G)throw Error("Cannot set HMAC key after calling update");g=(e||{}).encoding||"UTF8";c=H(c,g)(a);a=c.binLen;c=c.value;var m=u>>>3;e=m/4-1;if(m<a/8){for(c=q(c,a,0,y(b));c.length<=e;)c.push(0);c[e]&=4294967040}else if(m>a/8){for(;c.length<=e;)c.push(0);c[e]&=4294967040}for(a=0;a<=e;a+=1)k[a]=c[a]^909522486,f[a]=c[a]^1549556828;t=p(k,t);d=u;l=!0};this.update=function(a){var c,b=0,l=u>>>5;var f=w(a,e,m);a=f.binLen;var h=f.value;f=a>>>5;for(c=0;c<f;c+=l)b+u<=a&&(t=p(h.slice(c,c+l),t),b+=u);d+=
b;e=h.slice(b>>>5);m=a%u;G=!0};this.getHash=function(a,c){if(!0===l)throw Error("Cannot call getHash after setting HMAC key");var f=I(c);switch(a){case "HEX":a=function(a){return J(a,r,f)};break;case "B64":a=function(a){return K(a,r,f)};break;case "BYTES":a=function(a){return L(a,r)};break;case "ARRAYBUFFER":try{c=new ArrayBuffer(0)}catch(x){throw Error("ARRAYBUFFER not supported by this environment");}a=function(a){return M(a,r)};break;default:throw Error("format must be HEX, B64, BYTES, or ARRAYBUFFER");
}var k=q(e.slice(),m,d,n(t));for(c=1;c<h;c+=1)k=q(k,r,0,y(b));return a(k)};this.getHMAC=function(a,c){if(!1===l)throw Error("Cannot call getHMAC without first setting HMAC key");var h=I(c);switch(a){case "HEX":a=function(a){return J(a,r,h)};break;case "B64":a=function(a){return K(a,r,h)};break;case "BYTES":a=function(a){return L(a,r)};break;case "ARRAYBUFFER":try{a=new ArrayBuffer(0)}catch(x){throw Error("ARRAYBUFFER not supported by this environment");}a=function(a){return M(a,r)};break;default:throw Error("outputFormat must be HEX, B64, BYTES, or ARRAYBUFFER");
}c=q(e.slice(),m,d,n(t));var k=p(f,y(b));k=q(c,r,u,k);return a(k)}}function g(){}function J(b,a,c){var d="";a/=8;var e;for(e=0;e<a;e+=1){var m=b[e>>>2]>>>8*(3+e%4*-1);d+="0123456789abcdef".charAt(m>>>4&15)+"0123456789abcdef".charAt(m&15)}return c.outputUpper?d.toUpperCase():d}function K(b,a,c){var d="",e=a/8,m;for(m=0;m<e;m+=3){var l=m+1<e?b[m+1>>>2]:0;var k=m+2<e?b[m+2>>>2]:0;k=(b[m>>>2]>>>8*(3+m%4*-1)&255)<<16|(l>>>8*(3+(m+1)%4*-1)&255)<<8|k>>>8*(3+(m+2)%4*-1)&255;for(l=0;4>l;l+=1)8*m+6*l<=a?d+=
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k>>>6*(3-l)&63):d+=c.b64Pad}return d}function L(b,a){var c="";a/=8;var d;for(d=0;d<a;d+=1){var e=b[d>>>2]>>>8*(3+d%4*-1)&255;c+=String.fromCharCode(e)}return c}function M(b,a){a/=8;var c,d=new ArrayBuffer(a);var e=new Uint8Array(d);for(c=0;c<a;c+=1)e[c]=b[c>>>2]>>>8*(3+c%4*-1)&255;return d}function I(b){var a={outputUpper:!1,b64Pad:"=",shakeLen:-1};b=b||{};a.outputUpper=b.outputUpper||!1;!0===b.hasOwnProperty("b64Pad")&&(a.b64Pad=
b.b64Pad);b.hasOwnProperty("shakeLen");if("boolean"!==typeof a.outputUpper)throw Error("Invalid outputUpper formatting option");if("string"!==typeof a.b64Pad)throw Error("Invalid b64Pad formatting option");return a}function H(b,a){switch(a){case "UTF8":case "UTF16BE":case "UTF16LE":break;default:throw Error("encoding must be UTF8, UTF16BE, or UTF16LE");}switch(b){case "HEX":b=function(a,d,b){var c=a.length,e,k;if(c%2)throw Error("String of HEX type must be in byte increments");d=d||[0];b=b||0;var f=
b>>>3;for(e=0;e<c;e+=2){var g=parseInt(a.substr(e,2),16);if(isNaN(g))throw Error("String of HEX type contains invalid characters");var n=(e>>>1)+f;for(k=n>>>2;d.length<=k;)d.push(0);d[k]|=g<<8*(3+n%4*-1)}return{value:d,binLen:4*c+b}};break;case "TEXT":b=function(c,d,b){var e=0,l,k,f;d=d||[0];b=b||0;var g=b>>>3;if("UTF8"===a){var n=3;for(l=0;l<c.length;l+=1){var h=c.charCodeAt(l);var p=[];128>h?p.push(h):2048>h?(p.push(192|h>>>6),p.push(128|h&63)):55296>h||57344<=h?p.push(224|h>>>12,128|h>>>6&63,128|
h&63):(l+=1,h=65536+((h&1023)<<10|c.charCodeAt(l)&1023),p.push(240|h>>>18,128|h>>>12&63,128|h>>>6&63,128|h&63));for(k=0;k<p.length;k+=1){var q=e+g;for(f=q>>>2;d.length<=f;)d.push(0);d[f]|=p[k]<<8*(n+q%4*-1);e+=1}}}else if("UTF16BE"===a||"UTF16LE"===a)for(n=2,p="UTF16LE"===a&&!0||"UTF16LE"!==a&&!1,l=0;l<c.length;l+=1){h=c.charCodeAt(l);!0===p&&(k=h&255,h=k<<8|h>>>8);q=e+g;for(f=q>>>2;d.length<=f;)d.push(0);d[f]|=h<<8*(n+q%4*-1);e+=2}return{value:d,binLen:8*e+b}};break;case "B64":b=function(a,b,e){var c=
0,d,k;if(-1===a.search(/^[a-zA-Z0-9=+\/]+$/))throw Error("Invalid character in base-64 string");var f=a.indexOf("=");a=a.replace(/\=/g,"");if(-1!==f&&f<a.length)throw Error("Invalid '=' found in base-64 string");b=b||[0];e=e||0;var g=e>>>3;for(f=0;f<a.length;f+=4){var n=a.substr(f,4);for(d=k=0;d<n.length;d+=1){var h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(n[d]);k|=h<<18-6*d}for(d=0;d<n.length-1;d+=1){var p=c+g;for(h=p>>>2;b.length<=h;)b.push(0);b[h]|=(k>>>16-8*d&
255)<<8*(3+p%4*-1);c+=1}}return{value:b,binLen:8*c+e}};break;case "BYTES":b=function(a,b,e){var c;b=b||[0];e=e||0;var d=e>>>3;for(c=0;c<a.length;c+=1){var k=a.charCodeAt(c);var f=c+d;var g=f>>>2;b.length<=g&&b.push(0);b[g]|=k<<8*(3+f%4*-1)}return{value:b,binLen:8*a.length+e}};break;case "ARRAYBUFFER":try{b=new ArrayBuffer(0)}catch(c){throw Error("ARRAYBUFFER not supported by this environment");}b=function(a,b,e){var c;b=b||[0];e=e||0;var d=e>>>3;var k=new Uint8Array(a);for(c=0;c<a.byteLength;c+=1){var f=
c+d;var g=f>>>2;b.length<=g&&b.push(0);b[g]|=k[c]<<8*(3+f%4*-1)}return{value:b,binLen:8*a.byteLength+e}};break;default:throw Error("format must be HEX, TEXT, B64, BYTES, or ARRAYBUFFER");}return b}function n(b,a){return b>>>a|b<<32-a}function O(b,a,c){return b&a^~b&c}function P(b,a,c){return b&a^b&c^a&c}function Q(b){return n(b,2)^n(b,13)^n(b,22)}function R(b){return n(b,6)^n(b,11)^n(b,25)}function S(b){return n(b,7)^n(b,18)^b>>>3}function T(b){return n(b,17)^n(b,19)^b>>>10}function U(b,a){var c=
(b&65535)+(a&65535);return((b>>>16)+(a>>>16)+(c>>>16)&65535)<<16|c&65535}function V(b,a,c,d){var e=(b&65535)+(a&65535)+(c&65535)+(d&65535);return((b>>>16)+(a>>>16)+(c>>>16)+(d>>>16)+(e>>>16)&65535)<<16|e&65535}function W(b,a,c,d,e){var g=(b&65535)+(a&65535)+(c&65535)+(d&65535)+(e&65535);return((b>>>16)+(a>>>16)+(c>>>16)+(d>>>16)+(e>>>16)+(g>>>16)&65535)<<16|g&65535}function y(b){if(b.lastIndexOf("SHA-",0))throw Error("No SHA variants supported");var a=[3238371032,914150663,812702999,4144912697,4290775857,
1750603025,1694076839,3204075428];var c=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];switch(b){case "SHA-224":b=a;break;case "SHA-256":b=c;break;case "SHA-384":b=[new g,new g,new g,new g,new g,new g,new g,new g];break;case "SHA-512":b=[new g,new g,new g,new g,new g,new g,new g,new g];break;default:throw Error("Unknown SHA variant");}return b}function B(b,a,c){var d,e=[];if("SHA-224"===c||"SHA-256"===c){var g=64;var l=1;var k=Number;var f=U;var n=V;var w=
W;var h=S;var p=T;var q=Q;var y=R;var u=P;var r=O;var B=X}else throw Error("Unexpected error in SHA-2 implementation");c=a[0];var t=a[1];var A=a[2];var E=a[3];var z=a[4];var C=a[5];var x=a[6];var F=a[7];for(d=0;d<g;d+=1){if(16>d){var v=d*l;var D=b.length<=v?0:b[v];v=b.length<=v+1?0:b[v+1];e[d]=new k(D,v)}else e[d]=n(p(e[d-2]),e[d-7],h(e[d-15]),e[d-16]);D=w(F,y(z),r(z,C,x),B[d],e[d]);v=f(q(c),u(c,t,A));F=x;x=C;C=z;z=f(E,D);E=A;A=t;t=c;c=f(D,v)}a[0]=f(c,a[0]);a[1]=f(t,a[1]);a[2]=f(A,a[2]);a[3]=f(E,
a[3]);a[4]=f(z,a[4]);a[5]=f(C,a[5]);a[6]=f(x,a[6]);a[7]=f(F,a[7]);return a}var X=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,
2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(module.exports=w),exports=w):N.jsSHA=w})(this);
