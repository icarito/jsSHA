/*
 A JavaScript implementation of the SHA family of hashes, as
 defined in FIPS PUB 180-4 and FIPS PUB 202, as well as the corresponding
 HMAC implementation as defined in FIPS PUB 198a

 Copyright Brian Turek 2008-2017
 Distributed under the BSD License
 See http://caligatio.github.com/jsSHA/ for more information

 Several functions taken from Paul Johnston
*/
(function(H){function x(b,c,a){var g=[],f=0,h=!1,d=[],l=[],e=!1,p=!1,n=-1;a=a||{};var t=a.encoding||"UTF8";var k=a.numRounds||1;if(k!==parseInt(k,10)||1>k)throw Error("numRounds must a integer >= 1");if(b.lastIndexOf("SHA3-",0)&&b.lastIndexOf("SHAKE",0))throw Error("Chosen SHA variant is not supported");var r=6;var z=function(a){var b=[],d;for(d=0;5>d;d+=1)b[d]=a[d].slice();return b};n=1;if("SHA3-224"===b){var u=1152;var q=224}else if("SHA3-256"===b)u=1088,q=256;else if("SHA3-384"===b)u=832,q=384;
else if("SHA3-512"===b)u=576,q=512;else if("SHAKE128"===b)u=1344,q=-1,r=31,p=!0;else if("SHAKE256"===b)u=1088,q=-1,r=31,p=!0;else throw Error("Chosen SHA variant is not supported");var m=function(a,d,b,f,c){b=u;var h=r,g,l=[],e=b>>>5,p=0,k=d>>>5;for(g=0;g<k&&d>=b;g+=e)f=v(a.slice(g,g+e),f),d-=b;a=a.slice(g);for(d%=b;a.length<e;)a.push(0);g=d>>>3;a[g>>2]^=h<<g%4*8;a[e-1]^=2147483648;for(f=v(a,f);32*l.length<c;){a=f[p%5][p/5|0];l.push(a.b);if(32*l.length>=c)break;l.push(a.a);p+=1;64*p%b||v(null,f)}return l};
var x=A(c,t,n);var w=y(b);this.setHMACKey=function(a,f,c){if(!0===h)throw Error("HMAC key already set");if(!0===e)throw Error("Cannot set HMAC key after calling update");if(!0===p)throw Error("SHAKE is not supported for HMAC");t=(c||{}).encoding||"UTF8";f=A(f,t,n)(a);a=f.binLen;f=f.value;var g=u>>>3;c=g/4-1;if(g<a/8){for(f=m(f,a,0,y(b),q);f.length<=c;)f.push(0);f[c]&=4294967040}else if(g>a/8){for(;f.length<=c;)f.push(0);f[c]&=4294967040}for(a=0;a<=c;a+=1)d[a]=f[a]^909522486,l[a]=f[a]^1549556828;w=
v(d,w);h=!0};this.update=function(a){var d,b=0,c=u>>>5;var h=x(a,g,f);a=h.binLen;var l=h.value;h=a>>>5;for(d=0;d<h;d+=c)b+u<=a&&(w=v(l.slice(d,d+c),w),b+=u);g=l.slice(b>>>5);f=a%u;e=!0};this.getHash=function(a,d){if(!0===h)throw Error("Cannot call getHash after setting HMAC key");var c=B(d);if(!0===p){if(-1===c.shakeLen)throw Error("shakeLen must be specified in options");q=c.shakeLen}switch(a){case "HEX":a=function(a){return C(a,q,n,c)};break;case "B64":a=function(a){return D(a,q,n,c)};break;case "BYTES":a=
function(a){return E(a,q,n)};break;case "ARRAYBUFFER":try{d=new ArrayBuffer(0)}catch(I){throw Error("ARRAYBUFFER not supported by this environment");}a=function(a){return F(a,q,n)};break;default:throw Error("format must be HEX, B64, BYTES, or ARRAYBUFFER");}var l=m(g.slice(),f,0,z(w),q);for(d=1;d<k;d+=1)!0===p&&q%32&&(l[l.length-1]&=16777215>>>24-q%32),l=m(l,q,0,y(b),q);return a(l)};this.getHMAC=function(a,d){if(!1===h)throw Error("Cannot call getHMAC without first setting HMAC key");var c=B(d);switch(a){case "HEX":a=
function(a){return C(a,q,n,c)};break;case "B64":a=function(a){return D(a,q,n,c)};break;case "BYTES":a=function(a){return E(a,q,n)};break;case "ARRAYBUFFER":try{a=new ArrayBuffer(0)}catch(I){throw Error("ARRAYBUFFER not supported by this environment");}a=function(a){return F(a,q,n)};break;default:throw Error("outputFormat must be HEX, B64, BYTES, or ARRAYBUFFER");}d=m(g.slice(),f,0,z(w),q);var e=v(l,y(b));e=m(d,q,0,e,q);return a(e)}}function e(b,c){this.a=b;this.b=c}function C(b,c,a,g){var f="";c/=
8;var h;var d=-1===a?3:0;for(h=0;h<c;h+=1){var l=b[h>>>2]>>>8*(d+h%4*a);f+="0123456789abcdef".charAt(l>>>4&15)+"0123456789abcdef".charAt(l&15)}return g.outputUpper?f.toUpperCase():f}function D(b,c,a,g){var f="",h=c/8,d;var l=-1===a?3:0;for(d=0;d<h;d+=3){var e=d+1<h?b[d+1>>>2]:0;var p=d+2<h?b[d+2>>>2]:0;p=(b[d>>>2]>>>8*(l+d%4*a)&255)<<16|(e>>>8*(l+(d+1)%4*a)&255)<<8|p>>>8*(l+(d+2)%4*a)&255;for(e=0;4>e;e+=1)8*d+6*e<=c?f+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(p>>>
6*(3-e)&63):f+=g.b64Pad}return f}function E(b,c,a){var g="";c/=8;var f;var h=-1===a?3:0;for(f=0;f<c;f+=1){var d=b[f>>>2]>>>8*(h+f%4*a)&255;g+=String.fromCharCode(d)}return g}function F(b,c,a){c/=8;var g,f=new ArrayBuffer(c);var h=new Uint8Array(f);var d=-1===a?3:0;for(g=0;g<c;g+=1)h[g]=b[g>>>2]>>>8*(d+g%4*a)&255;return f}function B(b){var c={outputUpper:!1,b64Pad:"=",shakeLen:-1};b=b||{};c.outputUpper=b.outputUpper||!1;!0===b.hasOwnProperty("b64Pad")&&(c.b64Pad=b.b64Pad);if(!0===b.hasOwnProperty("shakeLen")){if(b.shakeLen%
8)throw Error("shakeLen must be a multiple of 8");c.shakeLen=b.shakeLen}if("boolean"!==typeof c.outputUpper)throw Error("Invalid outputUpper formatting option");if("string"!==typeof c.b64Pad)throw Error("Invalid b64Pad formatting option");return c}function A(b,c,a){switch(c){case "UTF8":case "UTF16BE":case "UTF16LE":break;default:throw Error("encoding must be UTF8, UTF16BE, or UTF16LE");}switch(b){case "HEX":b=function(c,f,b){var d=c.length,g,e;if(d%2)throw Error("String of HEX type must be in byte increments");
f=f||[0];b=b||0;var h=b>>>3;var n=-1===a?3:0;for(g=0;g<d;g+=2){var t=parseInt(c.substr(g,2),16);if(isNaN(t))throw Error("String of HEX type contains invalid characters");var k=(g>>>1)+h;for(e=k>>>2;f.length<=e;)f.push(0);f[e]|=t<<8*(n+k%4*a)}return{value:f,binLen:4*d+b}};break;case "TEXT":b=function(b,f,e){var d=0,g,h,p;f=f||[0];e=e||0;var n=e>>>3;if("UTF8"===c){var t=-1===a?3:0;for(g=0;g<b.length;g+=1){var k=b.charCodeAt(g);var r=[];128>k?r.push(k):2048>k?(r.push(192|k>>>6),r.push(128|k&63)):55296>
k||57344<=k?r.push(224|k>>>12,128|k>>>6&63,128|k&63):(g+=1,k=65536+((k&1023)<<10|b.charCodeAt(g)&1023),r.push(240|k>>>18,128|k>>>12&63,128|k>>>6&63,128|k&63));for(h=0;h<r.length;h+=1){var m=d+n;for(p=m>>>2;f.length<=p;)f.push(0);f[p]|=r[h]<<8*(t+m%4*a);d+=1}}}else if("UTF16BE"===c||"UTF16LE"===c)for(t=-1===a?2:0,r="UTF16LE"===c&&1!==a||"UTF16LE"!==c&&1===a,g=0;g<b.length;g+=1){k=b.charCodeAt(g);!0===r&&(h=k&255,k=h<<8|k>>>8);m=d+n;for(p=m>>>2;f.length<=p;)f.push(0);f[p]|=k<<8*(t+m%4*a);d+=2}return{value:f,
binLen:8*d+e}};break;case "B64":b=function(b,f,c){var d=0,e,g;if(-1===b.search(/^[a-zA-Z0-9=+\/]+$/))throw Error("Invalid character in base-64 string");var h=b.indexOf("=");b=b.replace(/\=/g,"");if(-1!==h&&h<b.length)throw Error("Invalid '=' found in base-64 string");f=f||[0];c=c||0;var n=c>>>3;var t=-1===a?3:0;for(h=0;h<b.length;h+=4){var k=b.substr(h,4);for(e=g=0;e<k.length;e+=1){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(k[e]);g|=r<<18-6*e}for(e=0;e<k.length-
1;e+=1){var m=d+n;for(r=m>>>2;f.length<=r;)f.push(0);f[r]|=(g>>>16-8*e&255)<<8*(t+m%4*a);d+=1}}return{value:f,binLen:8*d+c}};break;case "BYTES":b=function(b,c,e){var d;c=c||[0];e=e||0;var f=e>>>3;var g=-1===a?3:0;for(d=0;d<b.length;d+=1){var h=b.charCodeAt(d);var n=d+f;var m=n>>>2;c.length<=m&&c.push(0);c[m]|=h<<8*(g+n%4*a)}return{value:c,binLen:8*b.length+e}};break;case "ARRAYBUFFER":try{b=new ArrayBuffer(0)}catch(g){throw Error("ARRAYBUFFER not supported by this environment");}b=function(b,c,e){var d;
c=c||[0];e=e||0;var f=e>>>3;var g=-1===a?3:0;var h=new Uint8Array(b);for(d=0;d<b.byteLength;d+=1){var n=d+f;var m=n>>>2;c.length<=m&&c.push(0);c[m]|=h[d]<<8*(g+n%4*a)}return{value:c,binLen:8*b.byteLength+e}};break;default:throw Error("format must be HEX, TEXT, B64, BYTES, or ARRAYBUFFER");}return b}function G(b,c){return 32<c?(c-=32,new e(b.b<<c|b.a>>>32-c,b.a<<c|b.b>>>32-c)):c?new e(b.a<<c|b.b>>>32-c,b.b<<c|b.a>>>32-c):b}function m(b,c){return new e(b.a^c.a,b.b^c.b)}function y(b){var c=[];if(b.lastIndexOf("SHA3-",
0)&&b.lastIndexOf("SHAKE",0))throw Error("No SHA variants supported");for(b=0;5>b;b+=1)c[b]=[new e(0,0),new e(0,0),new e(0,0),new e(0,0),new e(0,0)];return c}function v(b,c){var a,g=[],f=[];if(null!==b)for(a=0;a<b.length;a+=2)c[(a>>>1)%5][(a>>>1)/5|0]=m(c[(a>>>1)%5][(a>>>1)/5|0],new e(b[a+1],b[a]));for(b=0;24>b;b+=1){var h=y("SHA3-");for(a=0;5>a;a+=1){var d=c[a][0];var l=c[a][1],v=c[a][2],p=c[a][3],n=c[a][4];g[a]=new e(d.a^l.a^v.a^p.a^n.a,d.b^l.b^v.b^p.b^n.b)}for(a=0;5>a;a+=1)f[a]=m(g[(a+4)%5],G(g[(a+
1)%5],1));for(a=0;5>a;a+=1)for(d=0;5>d;d+=1)c[a][d]=m(c[a][d],f[a]);for(a=0;5>a;a+=1)for(d=0;5>d;d+=1)h[d][(2*a+3*d)%5]=G(c[a][d],J[a][d]);for(a=0;5>a;a+=1)for(d=0;5>d;d+=1)c[a][d]=m(h[a][d],new e(~h[(a+1)%5][d].a&h[(a+2)%5][d].a,~h[(a+1)%5][d].b&h[(a+2)%5][d].b));c[0][0]=m(c[0][0],K[b])}return c}var K=[new e(0,1),new e(0,32898),new e(2147483648,32906),new e(2147483648,2147516416),new e(0,32907),new e(0,2147483649),new e(2147483648,2147516545),new e(2147483648,32777),new e(0,138),new e(0,136),new e(0,
2147516425),new e(0,2147483658),new e(0,2147516555),new e(2147483648,139),new e(2147483648,32905),new e(2147483648,32771),new e(2147483648,32770),new e(2147483648,128),new e(0,32778),new e(2147483648,2147483658),new e(2147483648,2147516545),new e(2147483648,32896),new e(0,2147483649),new e(2147483648,2147516424)];var J=[[0,36,3,41,18],[1,44,10,45,2],[62,6,43,15,61],[28,55,25,21,56],[27,20,39,8,14]];"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(module.exports=x),exports=
x):H.jsSHA=x})(this);
